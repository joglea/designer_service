
<div id="sample_1_wrapper" class="dataTables_wrapper no-footer">
    <div class="table-scrollable">
        <table class="table table-striped table-bordered table-hover dataTable no-footer" id="sample_1" role="grid" aria-describedby="sample_1_info">
        <thead>
            <tr role="row">
                <!--<th class="table-checkbox sorting_disabled" rowspan="1" colspan="1" aria-label=" " style="width: 24px;">
                    <div class="checker">
                        <span>
                            <input type="checkbox" class="group-checkable" data-set="#sample_1 .checkboxes">
                        </span>
                    </div>
                </th>-->
                <th class="sorting_disabled text-center" rowspan="1" colspan="1" aria-label="" style="width: 15%;">
                    模块(分组)名
                </th>
                <th class="sorting_disabled text-center" rowspan="1" colspan="1" aria-label="" style="width: 5%;">
                    排序值
                </th>
                <th class="sorting_disabled text-center" rowspan="1" colspan="1" aria-label=""  style="width:10%;">
                    唯一标志
                </th>
                <th class="sorting_disabled text-center" rowspan="1" colspan="1" aria-label="" style="width: 15%;">
                    访问路径
                </th>
                <th class="sorting_disabled text-center" rowspan="1" colspan="1" aria-label="" style="width: 6%;">
                    模块状态
                </th>
                <th class="sorting_disabled text-center" rowspan="1" colspan="1" aria-label="" style="width: 20%;">
                    描述信息
                </th>
                <th class="sorting_disabled text-center" rowspan="1" colspan="1" aria-label="" style="width: 23%;">
                    操作
                </th>
            </tr>
        </thead>
        <tbody>
        {foreach name="modulegrouplist" item="onemodulegroup" key="mgkey" }
            <tr class="gradeX {php} if($mgkey%2==0){ echo 'even';}else{echo 'odd';}{/php}" role="row" id="module_group_{$onemodulegroup.modulegroupid}">
                <!--<td>
                    <div class="checker"><span><input type="checkbox" class="checkboxes" value="1"></span></div>
                </td>-->
                <td class="text-left" >
                    <i class="{$onemodulegroup.modulegroupicon}"></i>
                    {$onemodulegroup.modulegroupname}
                </td>
                <td class="text-left">
                    <!--<a href="mailto:userwow@gmail.com">
                        good@gmail.com </a>-->
                    {$onemodulegroup.modulegroupsort}
                </td>
                <td class="text-center">
                    -
                </td>
                <td class="text-center">
                    -
                </td>
                <td class="text-center">
                    -
                </td>
                <td class="text-center">
                    -
                </td>
                <td class="text-center">
                    <a onclick="addmodule({$onemodulegroup.modulegroupid})" href="javascript:" title="添加模块" class="btn btn-primary btn-xs">
                        <i class="fa fa-plus"></i> 添加
                    </a>
                    <a onclick="editmodulegroup({$onemodulegroup.modulegroupid})" href="javascript:" title="修改模块分组" class="btn btn-warning btn-xs">
                        <i class="fa fa-pencil"></i> 修改
                    </a>
                    <a onclick="removemodulegroup({$onemodulegroup.modulegroupid})" href="javascript:" title="删除模块分组" class="btn btn-danger btn-xs">
                        <i class="fa fa-trash-o"></i> 删除
                    </a>
                </td>
            </tr>
            {foreach name="modulelist" item="onemodule" key="mkey" }
            {php}
            if($onemodule['module_group_id']==$onemodulegroup['modulegroupid']){
            {/php}

            <tr class="gradeX {php} if($mkey%2==0){ echo 'even';}else{echo 'odd';}{/php}" role="row"  id="module_{$onemodule.moduleid}">
                <!--<td>
                    <div class="checker"><span><input type="checkbox" class="checkboxes" value="1"></span></div>
                </td>-->
                <td class="text-left">
                    ➤&nbsp;&nbsp;<i class="{$onemodule.moduleicon}"></i>&nbsp;&nbsp;{$onemodule.modulename}
                </td>
                <td class="text-right">
                    {$onemodule.modulesort}
                </td>
                <td class="text-center">
                    {$onemodule.identityname}
                </td>
                <td class="text-center">
                    {$onemodule.url}
                </td>
                <td class="text-center">
                    {php}
                    if($onemodule['modulestate']==1){
                    echo "正常";
                    }
                    else{
                    echo "禁用";
                    }
                    {/php}
                </td>
                <td class="text-center">
                    {$onemodule.description}
                </td>
                <td class="text-center">
                    <a onclick="modulerightlist({$onemodule.moduleid})" href="javascript:" title="权限列表" class="btn btn-primary btn-xs">
                        <i class="fa fa-list"></i> 权限
                    </a>
                    <a onclick="editmodule({$onemodule.moduleid})" href="javascript:" title="修改模块分组" class="btn btn-warning btn-xs">
                        <i class="fa fa-pencil"></i> 修改
                    </a>
                    <a onclick="removemodule({$onemodule.moduleid})" href="javascript:" title="删除模块分组" class="btn btn-danger btn-xs">
                        <i class="fa fa-trash-o"></i> 删除
                    </a>
                </td>
            </tr>
            {php}
            }
            {/php}
            {/foreach}
        {/foreach}
            </tbody>
        </table>
    </div>

</div>


<script type="text/javascript">
var TableManaged = function () {

    var initTable1 = function () {

        var table = $('#sample_1');

        // begin first table
        table.dataTable({
            "paging":   false,
            "ordering": false,
            //"info":     false,
            "columns": [{
                "orderable": false
            }, {
                "orderable": false
            }, {
                "orderable": false
            }, {
                "orderable": false
            }, {
                "orderable": false
            }, {
                "orderable": false
            }, {
                "orderable": false
            }],
            "lengthMenu": [
                [5, 15, 20, -1],
                [5, 15, 20, "全部"] // change per page values here
            ],
            // set the initial value
            "pageLength": 3,
            "pagingType": "bootstrap_full_number",
            "language": {
                "lengthMenu": "  _MENU_ 条",
                "paginate": {
                    "previous":"上一页",
                    "next": "下一页",
                    "last": "最后一页",
                    "first": "第一页"
                }
            },
            "columnDefs": [{  // set default column settings
                'orderable': false,
                'targets': [0]
            }, {
                "searchable": true,
                "targets": [0]
            }],
            "order": [
                [1, "asc"]
            ] // set first column as a default sort by asc
        });

        var tableWrapper = jQuery('#sample_1_wrapper');

        table.find('.group-checkable').change(function () {
            var set = jQuery(this).attr("data-set");
            var checked = jQuery(this).is(":checked");
            jQuery(set).each(function () {
                if (checked) {
                    $(this).attr("checked", true);
                    $(this).parents('tr').addClass("active");
                    $(this).parents('span').addClass("checked");
                } else {
                    $(this).attr("checked", false);
                    $(this).parents('tr').removeClass("active");
                    $(this).parents('span').removeClass("checked");
                }
            });

            $(this).parents('span').toggleClass("checked");
            jQuery.uniform.update(set);
        });

        table.on('change', 'tbody tr .checkboxes', function () {
            $(this).parents('tr').toggleClass("active");
            $(this).parents('span').toggleClass("checked");
        });

        tableWrapper.find('.dataTables_length select').addClass("form-control input-xsmall input-inline"); // modify table per page dropdown
    }


    return {

        //main function to initiate the module
        init: function () {
            if (!jQuery().dataTable) {
                return;
            }

            initTable1();
        }

    };

}();

jQuery(document).ready(function() {
    TableManaged.init();
});


function addmodulegroup()
{
    BootstrapDialog.show({
    	title:'添加模块分组',
        message: function(dialog) {
            var $message = $('<div></div>');
            var pageToLoad = dialog.getData('url');
            $message.load(pageToLoad);
            return $message;
        },
        closable: true,
        draggable: true,
        data: {
            'url': '__URL__'+'/addmodulegroup'
        },
        buttons: [{
            id: 'btn-1',
            label: '添加',
            cssClass: 'btn-primary',
            action: function(dialog) {
                var $button = this; // 'this' here is a jQuery object that wrapping the <button> DOM element.
                $button.disable();
                $button.prepend('<i class="fa fa-spinner fa-spin"></i>');
                dialog.setClosable(false);
                if(!$('#addmodulegroupform').data('bootstrapValidator').validate().isValid())
                {
                    $button.enable();
                    dialog.setClosable(true);
                    $button.find('.fa-spinner').remove();
                    return;
                }
                var formData=$('#addmodulegroupform').serialize();
                $.ajax({
                    url: '__URL__' + '/addmodulegroup',
                    type: 'POST',
                    dataType: 'JSON',
                    timeout: 30000, //超时时间：30秒
                    data: formData,
                    error: function () {
                    	$button.enable();
                        dialog.setClosable(true);
                        $button.find('.fa-spinner').remove();

                        showNotify(-1,'添加模块分组错误',1,'warning',0);
                    },
                    success: function (data) {
                    	$button.enable();
                        dialog.setClosable(true);
                        $button.find('.fa-spinner').remove();
                        //alert(data.code);
                        if(data.code==0)
                        {
                        	$('.dialog_notify').remove();
                        	dialog.close();
                            $('#content-list').html(data.html);
                        }
                        //alert(3);
                        showNotify(data.code,data.msg,1,data.msg_type,0);
                        //alert(3);
                    }
                });
            }
        },
        {
            label: '取消',
            action: function(dialog){
            	dialog.close();
            }
        }]
    });
}

function editmodulegroup(modulegroupid)
{

	BootstrapDialog.show({
    	title:'修改模块分组',
        message: function(dialog) {
            var $message = $('<div></div>');
            var pageToLoad = dialog.getData('url');
            $message.load(pageToLoad);
            return $message;
        },
        closable: true,
        draggable: true,
        data: {
            'url': '__URL__'+'/editmodulegroup?modulegroupid='+modulegroupid
        },
        buttons: [{
            id: 'btn-1',
            label: '保存',
            cssClass: 'btn-success',
            action: function(dialog) {
                var $button = this; // 'this' here is a jQuery object that wrapping the <button> DOM element.
                $button.disable();
                $button.prepend('<i class="fa fa-spinner fa-spin"></i>');
                dialog.setClosable(false);

                if(!$('#editmodulegroupform').data('bootstrapValidator').validate().isValid())
                {
                    $button.enable();
                    dialog.setClosable(true);
                    $button.find('.fa-spinner').remove();
                    return;
                }
                var formData=$('#editmodulegroupform').serialize();
                $.ajax({
                    url: '__URL__' + '/editmodulegroup',
                    type: 'POST',
                    dataType: 'JSON',
                    timeout: 30000, //超时时间：30秒
                    data: formData,
                    error: function () {
                    	$button.enable();
                        dialog.setClosable(true);
                        $button.find('.fa-spinner').remove();
                        showNotify(-1,'保存模块分组错误',1,'warning',0);
                    },
                    success: function (data) {
                    	$button.enable();
                        dialog.setClosable(true);
                        $button.find('.fa-spinner').remove();
                        if(data.code==0)
                        {
                            $('.dialog_notify').remove();
                        	dialog.close();
                        	$('#content-list').html(data.html);
                        }
                        showNotify(data.code,data.msg,1,data.msg_type,0);

                    }
                });
            }
        },
        {
            label: '取消',
            action: function(dialog){
            	dialog.close();
            }
        }]
    });
}

function removemodulegroup(modulegroupid)
{
	BootstrapDialog.confirm('请确认','确定删除模块组及它的子模块模块数据吗?', function(result){
        if(result) {
        	$.ajax({
                url: '__URL__' + '/removemodulegroup',
                type: 'POST',
                dataType: 'JSON',
                timeout: 30000, //超时时间：30秒
                data: {
                    modulegroupid: modulegroupid
                },
                error: function () {
                  	//出现错误，直接显示通知。判断是否有dialog，有的话就显示在上面，没有就显示在全局通知。
                    showNotify(-1,'删除错误',1,'warning',0);
                },
                success: function (data) {
                	if(data.code==0)
                    {
                        $('.dialog_notify').remove();
                    	$('#module_group_'+modulegroupid).hide();
                    }
                    showNotify(data.code,data.msg,1,data.msg_type,0);
                }
            });
        }
        else
        {
        	return false;
        }
    });
}

function addmodule(modulegroupid)
{
	BootstrapDialog.show({
	    	title:'添加模块',
	        message: function(dialog) {
	            var $message = $('<div></div>');
	            var pageToLoad = dialog.getData('url');
	            $message.load(pageToLoad);
	            return $message;
	        },
	        closable: true,
	        draggable: true,
	        data: {
	            'url': '__URL__'+'/addmodule?modulegroupid='+modulegroupid
	        },
	        buttons: [{
	            id: 'btn-1',
	            label: '添加',
	            cssClass: 'btn-primary',
	            action: function(dialog) {
	                var $button = this; // 'this' here is a jQuery object that wrapping the <button> DOM element.
	                $button.disable();
	                $button.prepend('<i class="fa fa-spinner fa-spin"></i>');
	                dialog.setClosable(false);
	                if(!$('#addmoduleform').data('bootstrapValidator').validate().isValid())
	                {
	                    $button.enable();
	                    dialog.setClosable(true);
	                    $button.find('.fa-spinner').remove();
	                    return;
	                }
	                var formData=$('#addmoduleform').serialize();
	                $.ajax({
	                    url: '__URL__' + '/addmodule',
	                    type: 'POST',
	                    dataType: 'JSON',
	                    timeout: 30000, //超时时间：30秒
	                    data: formData,
	                    error: function () {
	                    	$button.enable();
	                        dialog.setClosable(true);
	                        $button.find('.fa-spinner').remove();

	                        //出现错误，直接显示通知。判断是否有dialog，有的话就显示在上面，没有就显示在全局通知。
                            showNotify(-1,'添加模块分组错误',1,'warning',0);
	                    },
	                    success: function (data) {
	                    	$button.enable();
	                        dialog.setClosable(true);
	                        $button.find('.fa-spinner').remove();
	                        if(data.code==0)
	                        {
	                            $('.dialog_notify').remove();
	                        	dialog.close();
	                        	$('#content-list').html(data.html);
	                        }
	                        showNotify(data.code,data.msg,1,data.msg_type,0);
	                    }
	                });
	            }
	        },
	        {
	            label: '取消',
	            action: function(dialog){
	            	dialog.close();
	            }
	        }]
	    });
}


function editmodule(moduleid)
{
	BootstrapDialog.show({
    	title:'修改模块',
        message: function(dialog) {
            var $message = $('<div></div>');
            var pageToLoad = dialog.getData('url');
            $message.load(pageToLoad);
            return $message;
        },
        closable: true,
        draggable: true,
        data: {
            'url': '__URL__'+'/editmodule?moduleid='+moduleid
        },
        buttons: [{
            id: 'btn-1',
            label: '保存',
            cssClass: 'btn-success',
            action: function(dialog) {
                var $button = this; // 'this' here is a jQuery object that wrapping the <button> DOM element.
                $button.disable();
                $button.prepend('<i class="fa fa-spinner fa-spin"></i>');
                dialog.setClosable(false);
                if(!$('#editmoduleform').data('bootstrapValidator').validate().isValid())
                {
                    $button.enable();
                    dialog.setClosable(true);
                    $button.find('.fa-spinner').remove();
                    return;
                }
                var formData=$('#editmoduleform').serialize();
                $.ajax({
                    url: '__URL__' + '/editmodule',
                    type: 'POST',
                    dataType: 'JSON',
                    timeout: 30000, //超时时间：30秒
                    data: formData,
                    error: function () {
                    	$button.enable();
                        dialog.setClosable(true);
                        $button.find('.fa-spinner').remove();

                        //出现错误，直接显示通知。判断是否有dialog，有的话就显示在上面，没有就显示在全局通知。
                        showNotify(-1,'保存模块错误',1,'warning',0);
                    },
                    success: function (data) {
                    	$button.enable();
                        dialog.setClosable(true);
                        $button.find('.fa-spinner').remove();
                        if(data.code==0)
                        {
                            $('.dialog_notify').remove();
                        	dialog.close();
                        	$('#content-list').html(data.html);
                        }
                        showNotify(data.code,data.msg,1,data.msg_type,0);
                    }
                });
            }
        },
        {
            label: '取消',
            action: function(dialog){
            	dialog.close();
            }
        }]
    });
}

function removemodule(moduleid)
{
	BootstrapDialog.confirm('请确认','确定删除模块数据吗?', function(result){
        if(result) {
        	$.ajax({
                url: '__URL__' + '/removemodule',
                type: 'POST',
                dataType: 'JSON',
                timeout: 30000, //超时时间：30秒
                data: {
                    moduleid: moduleid
                },
                error: function () {
                  	//出现错误，直接显示通知。判断是否有dialog，有的话就显示在上面，没有就显示在全局通知。
                    showNotify(-1,'删除模块错误',1,'warning',0);
                },
                success: function (data) {
                	if(data.code==0)
                    {
                        $('.dialog_notify').remove();
                    	$('#module_'+moduleid).hide();
                    }
                    showNotify(data.code,data.msg,1,data.msg_type,0);
                }
            });
        }
        else
        {
        	return false;
        }
    });
}

function modulerightlist(moduleid)
{
	BootstrapDialog.show({
		modalDialogClass:'modal-dialog-lg',
    	title:'模块权限列表',
        message: function(dialog) {
            var $message = $('<div id="module_right_list"></div>');
            var pageToLoad = dialog.getData('url');
            $message.load(pageToLoad);
            return $message;
        },
        closable: true,
        draggable: true,
        data: {
            'url': '__URL__'+'/modulerightlist?moduleid='+moduleid
        },
        buttons: [
        {
            label: '关闭',
            action: function(dialog){
            	dialog.close();
            }
        }]
    });
}

</script>




